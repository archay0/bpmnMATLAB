var sourceData0 = {"FileName":"C:\\Users\\Archay wakodikar\\Documents\\MATLAB\\src\\BPMNDatabaseConnector.m","RawFileContents":["classdef BPMNDatabaseConnector < handle\r","    % BPMNDatabaseConnector Class for database interactions\r","    % This class provides methods for connecting to databases and extracting\r","    % process information for BPMN generation\r","    \r","    properties\r","        Connection      % Database connection object\r","        DbType          % Type of database (mysql, postgresql, etc.)\r","        Connected       % Boolean flag indicating if connected\r","        QueryCache      % Cache for commonly used queries\r","        EnvVars         % Environment variables loaded from .env file\r","    end\r","    \r","    methods\r","        function obj = BPMNDatabaseConnector(dbType)\r","            % Constructor for BPMNDatabaseConnector\r","            % dbType: Type of database (mysql, postgresql, etc.)\r","            \r","            if nargin > 0\r","                obj.DbType = dbType;\r","            else\r","                % Try to load from environment file\r","                try\r","                    obj.loadEnvironmentVars();\r","                    if isfield(obj.EnvVars, 'DB_TYPE')\r","                        obj.DbType = obj.EnvVars.DB_TYPE;\r","                    else\r","                        obj.DbType = '';\r","                    end\r","                catch ex\r","                    fprintf('Could not load environment variables: %s\\n', ex.message);\r","                    obj.DbType = '';\r","                end\r","            end\r","            \r","            obj.Connected = false;\r","            obj.QueryCache = containers.Map();\r","        end\r","        \r","        function loadEnvironmentVars(obj, envFilePath)\r","            % Load environment variables from the .env file\r","            % envFilePath: Optional path to the .env file\r","            \r","            try\r","                if nargin < 2\r","                    % Use the default loadEnvironment function to get the variables\r","                    utilPath = fileparts(mfilename('fullpath'));\r","                    utilFolder = fullfile(utilPath, 'util');\r","                    \r","                    % Ensure the util folder is on the path\r","                    if ~any(contains(path, utilFolder))\r","                        addpath(utilFolder);\r","                    end\r","                    \r","                    obj.EnvVars = loadEnvironment();\r","                else\r","                    obj.EnvVars = loadEnvironment(envFilePath);\r","                end\r","                fprintf('Environment variables loaded successfully\\n');\r","            catch ex\r","                warning('Error loading environment variables: %s', ex.message);\r","                obj.EnvVars = struct();\r","            end\r","        end\r","        \r","        function success = connectWithEnvFile(obj, envFilePath)\r","            % Connect to database using credentials from the .env file\r","            % envFilePath: Optional path to the .env file\r","            \r","            try\r","                % Load environment variables if not already loaded\r","                if isempty(obj.EnvVars) || ~isfield(obj.EnvVars, 'DB_HOST')\r","                    if nargin < 2\r","                        obj.loadEnvironmentVars();\r","                    else\r","                        obj.loadEnvironmentVars(envFilePath);\r","                    end\r","                end\r","                \r","                % Set database type if specified in the environment\r","                if isfield(obj.EnvVars, 'DB_TYPE') && isempty(obj.DbType)\r","                    obj.DbType = obj.EnvVars.DB_TYPE;\r","                end\r","                \r","                % Build connection parameters from environment variables\r","                connectionParams = struct();\r","                \r","                if isfield(obj.EnvVars, 'DB_NAME')\r","                    connectionParams.dbName = obj.EnvVars.DB_NAME;\r","                else\r","                    error('DB_NAME not found in environment variables');\r","                end\r","                \r","                if isfield(obj.EnvVars, 'DB_USER')\r","                    connectionParams.username = obj.EnvVars.DB_USER;\r","                else\r","                    connectionParams.username = '';\r","                end\r","                \r","                if isfield(obj.EnvVars, 'DB_PASSWORD')\r","                    connectionParams.password = obj.EnvVars.DB_PASSWORD;\r","                else\r","                    connectionParams.password = '';\r","                end\r","                \r","                if isfield(obj.EnvVars, 'DB_HOST')\r","                    connectionParams.server = obj.EnvVars.DB_HOST;\r","                else\r","                    connectionParams.server = 'localhost';\r","                end\r","                \r","                if isfield(obj.EnvVars, 'DB_PORT')\r","                    connectionParams.port = obj.EnvVars.DB_PORT;\r","                else\r","                    connectionParams.port = 3306;\r","                end\r","                \r","                % Additional configuration for SQLite\r","                if strcmpi(obj.DbType, 'sqlite') && isfield(obj.EnvVars, 'DB_FILE_PATH')\r","                    connectionParams.filePath = obj.EnvVars.DB_FILE_PATH;\r","                end\r","                \r","                % Additional configuration for ODBC\r","                if strcmpi(obj.DbType, 'odbc') && isfield(obj.EnvVars, 'DB_DSN')\r","                    connectionParams.dsn = obj.EnvVars.DB_DSN;\r","                end\r","                \r","                % Connect using the standard connect method\r","                success = obj.connect(connectionParams);\r","                \r","            catch ex\r","                success = false;\r","                error('Error connecting with environment file: %s', ex.message);\r","            end\r","        end\r","        \r","        function success = connect(obj, connectionParams)\r","            % Connect to database\r","            % connectionParams: Structure with connection parameters\r","            %   - dbName: Database name\r","            %   - username: Database username\r","            %   - password: Database password\r","            %   - server: Database server address\r","            %   - port: Database port number\r","            \r","            try\r","                % Use MATLAB Database Toolbox to establish connection\r","                switch lower(obj.DbType)\r","                    case 'mysql'\r","                        obj.Connection = database(connectionParams.dbName, ...\r","                                                connectionParams.username, ...\r","                                                connectionParams.password, ...\r","                                                'Vendor', 'MySQL', ...\r","                                                'Server', connectionParams.server, ...\r","                                                'PortNumber', connectionParams.port);\r","                    case 'postgresql'\r","                        obj.Connection = database(connectionParams.dbName, ...\r","                                                connectionParams.username, ...\r","                                                connectionParams.password, ...\r","                                                'Vendor', 'PostgreSQL', ...\r","                                                'Server', connectionParams.server, ...\r","                                                'PortNumber', connectionParams.port);\r","                    case 'sqlite'\r","                        obj.Connection = database(connectionParams.dbName, '', '', ...\r","                                                'Vendor', 'SQLite', ...\r","                                                'DataSource', connectionParams.filePath);\r","                    case 'odbc'\r","                        obj.Connection = database('', connectionParams.username, ...\r","                                                connectionParams.password, ...\r","                                                'Vendor', 'ODBC', ...\r","                                                'DataSource', connectionParams.dsn);\r","                    otherwise\r","                        error('Unsupported database type: %s', obj.DbType);\r","                end\r","                \r","                if ~isempty(obj.Connection.Message)\r","                    error('Database connection failed: %s', obj.Connection.Message);\r","                end\r","                \r","                obj.Connected = true;\r","                success = true;\r","                fprintf('Successfully connected to %s database\\n', obj.DbType);\r","            catch ex\r","                obj.Connected = false;\r","                success = false;\r","                error('Error connecting to database: %s', ex.message);\r","            end\r","        end\r","        \r","        function disconnect(obj)\r","            % Disconnect from database\r","            if obj.Connected && ~isempty(obj.Connection)\r","                close(obj.Connection);\r","                obj.Connected = false;\r","                fprintf('Disconnected from %s database\\n', obj.DbType);\r","            end\r","        end\r","        \r","        function data = queryProcessDefinitions(obj)\r","            % Query process definitions from database\r","            % Returns a table of process definitions\r","            \r","            if ~obj.Connected\r","                error('Database connection not established. Call connect first.');\r","            end\r","            \r","            % Query depends on database structure - this is a generic example\r","            query = ['SELECT process_id, process_name, description ', ...\r","                     'FROM process_definitions ', ...\r","                     'ORDER BY process_id'];\r","            \r","            data = exec(obj.Connection, query);\r","            data = fetch(data);\r","        end\r","        \r","        function data = queryProcessElements(obj, processId)\r","            % Query process elements for a specific process\r","            % processId: ID of the process to query elements for\r","            % Returns a table of process elements\r","            \r","            if ~obj.Connected\r","                error('Database connection not established. Call connect first.');\r","            end\r","            \r","            % Query depends on database structure - this is a generic example\r","            query = ['SELECT element_id, element_type, element_name, properties ', ...\r","                     'FROM process_elements ', ...\r","                     'WHERE process_id = ''', processId, ''' ', ...\r","                     'ORDER BY element_id'];\r","            \r","            data = exec(obj.Connection, query);\r","            data = fetch(data);\r","        end\r","        \r","        function data = querySequenceFlows(obj, processId)\r","            % Query sequence flows for a specific process\r","            % processId: ID of the process to query flows for\r","            % Returns a table of sequence flows\r","            \r","            if ~obj.Connected\r","                error('Database connection not established. Call connect first.');\r","            end\r","            \r","            % Query depends on database structure - this is a generic example\r","            query = ['SELECT flow_id, source_ref, target_ref, condition_expr ', ...\r","                     'FROM process_flows ', ...\r","                     'WHERE process_id = ''', processId, ''' ', ...\r","                     'ORDER BY flow_id'];\r","            \r","            data = exec(obj.Connection, query);\r","            data = fetch(data);\r","        end\r","        \r","        function schemaInfo = getTableSchema(obj, tableName)\r","            % Get schema information for a specific table\r","            % tableName: Name of the table to get schema for\r","            % Returns structure with table schema information\r","            \r","            if ~obj.Connected\r","                error('Database connection not established. Call connect first.');\r","            end\r","            \r","            % Get table information\r","            tableInfo = obj.Connection.sqltables('TableType', 'TABLE', 'Table', tableName);\r","            \r","            % Get column information\r","            columnInfo = obj.Connection.sqlcolumns('Table', tableName);\r","            \r","            % Combine into schema info structure\r","            schemaInfo = struct('tableName', tableName, ...\r","                               'columns', columnInfo, ...\r","                               'tableInfo', tableInfo);\r","        end\r","        \r","        function tables = listTables(obj)\r","            % List all tables in the current database\r","            % Returns a cell array of table names\r","            \r","            if ~obj.Connected\r","                error('Database connection not established. Call connect first.');\r","            end\r","            \r","            % Get all tables\r","            tableInfo = obj.Connection.sqltables('TableType', 'TABLE');\r","            \r","            if isempty(tableInfo)\r","                tables = {};\r","            else\r","                tables = tableInfo.TABLE_NAME;\r","            end\r","        end\r","        \r","        function result = executeCustomQuery(obj, query)\r","            % Execute a custom SQL query\r","            % query: SQL query string to execute\r","            % Returns query results\r","            \r","            if ~obj.Connected\r","                error('Database connection not established. Call connect first.');\r","            end\r","            \r","            % Check if query is in cache\r","            if obj.QueryCache.isKey(query)\r","                result = obj.QueryCache(query);\r","            else\r","                % Execute query\r","                result = exec(obj.Connection, query);\r","                result = fetch(result);\r","                \r","                % Cache result if it's not too large\r","                if height(result) < 1000\r","                    obj.QueryCache(query) = result;\r","                end\r","            end\r","        end\r","        \r","        function data = fetchElements(obj, processId)\r","            % Fetch all BPMN elements with their attributes for a process\r","            % processId: ID of the process to fetch elements for\r","            % Returns a table with element data according to DatabaseSchema.md\r","            \r","            if ~obj.Connected\r","                error('Database connection not established. Call connect first.');\r","            end\r","            \r","            % Check if we have the schema that matches DatabaseSchema.md\r","            tables = obj.listTables();\r","            \r","            % Check if we have the modern schema structure\r","            if ismember('bpmn_elements', tables)\r","                % Use the schema from DatabaseSchema.md\r","                query = ['SELECT e.*, t.implementation, t.script, t.script_format, ', ...\r","                         'ev.event_definition_type, ev.is_interrupting, ev.attached_to_ref, ', ...\r","                         'g.gateway_direction, p.container_type, p.process_ref, p.parent_id, ', ...\r","                         'ep.x, ep.y, ep.width, ep.height, ep.is_expanded ', ...\r","                         'FROM bpmn_elements e ', ...\r","                         'LEFT JOIN tasks t ON e.element_id = t.task_id ', ...\r","                         'LEFT JOIN events ev ON e.element_id = ev.event_id ', ...\r","                         'LEFT JOIN gateways g ON e.element_id = g.gateway_id ', ...\r","                         'LEFT JOIN pools_and_lanes p ON e.element_id = p.container_id ', ...\r","                         'LEFT JOIN element_positions ep ON e.element_id = ep.element_id ', ...\r","                         'WHERE e.process_id = ''', processId, ''' ', ...\r","                         'ORDER BY e.element_id'];\r","            else\r","                % Use a generic query for backwards compatibility\r","                query = ['SELECT element_id, element_type, element_name, properties ', ...\r","                         'FROM process_elements ', ...\r","                         'WHERE process_id = ''', processId, ''' ', ...\r","                         'ORDER BY element_id'];\r","            end\r","            \r","            data = exec(obj.Connection, query);\r","            data = fetch(data);\r","            \r","            % Cache the result\r","            cacheKey = ['elements_', processId];\r","            if height(data) < 1000\r","                obj.QueryCache(cacheKey) = data;\r","            end\r","        end\r","        \r","        function data = fetchSequenceFlows(obj, processId)\r","            % Fetch sequence flows with waypoints for a process\r","            % processId: ID of the process to fetch flows for\r","            % Returns a table with flow data and associated waypoints\r","            \r","            if ~obj.Connected\r","                error('Database connection not established. Call connect first.');\r","            end\r","            \r","            tables = obj.listTables();\r","            \r","            % Check if we have the modern schema structure\r","            if ismember('sequence_flows', tables) && ismember('waypoints', tables)\r","                % Join with waypoints table to get the path data\r","                query = ['SELECT sf.*, GROUP_CONCAT(CONCAT(wp.sequence, \":\", wp.x, \":\", wp.y) ', ...\r","                         'ORDER BY wp.sequence SEPARATOR \";\") as waypoints_data ', ...\r","                         'FROM sequence_flows sf ', ...\r","                         'LEFT JOIN waypoints wp ON sf.flow_id = wp.flow_id ', ...\r","                         'WHERE sf.process_id = ''', processId, ''' ', ...\r","                         'GROUP BY sf.flow_id ', ...\r","                         'ORDER BY sf.flow_id'];\r","            else\r","                % Fallback to generic query\r","                query = ['SELECT flow_id, source_ref, target_ref, condition_expr ', ...\r","                         'FROM process_flows ', ...\r","                         'WHERE process_id = ''', processId, ''' ', ...\r","                         'ORDER BY flow_id'];\r","            end\r","            \r","            data = exec(obj.Connection, query);\r","            data = fetch(data);\r","            \r","            % Cache the result\r","            cacheKey = ['flows_', processId];\r","            if height(data) < 1000\r","                obj.QueryCache(cacheKey) = data;\r","            end\r","        end\r","        \r","        function data = fetchMessageFlows(obj)\r","            % Fetch message flows between pools/participants\r","            % Returns a table with message flow data\r","            \r","            if ~obj.Connected\r","                error('Database connection not established. Call connect first.');\r","            end\r","            \r","            tables = obj.listTables();\r","            \r","            % Check if we have the modern schema structure\r","            if ismember('message_flows', tables) && ismember('waypoints', tables)\r","                query = ['SELECT mf.*, GROUP_CONCAT(CONCAT(wp.sequence, \":\", wp.x, \":\", wp.y) ', ...\r","                         'ORDER BY wp.sequence SEPARATOR \";\") as waypoints_data ', ...\r","                         'FROM message_flows mf ', ...\r","                         'LEFT JOIN waypoints wp ON mf.flow_id = wp.flow_id ', ...\r","                         'GROUP BY mf.flow_id ', ...\r","                         'ORDER BY mf.flow_id'];\r","                         \r","                data = exec(obj.Connection, query);\r","                data = fetch(data);\r","            else\r","                % Return empty table if the schema doesn't support message flows\r","                data = table();\r","            end\r","            \r","            % Cache the result\r","            if height(data) < 1000\r","                obj.QueryCache('message_flows') = data;\r","            end\r","        end\r","        \r","        function data = fetchDataObjects(obj, processId)\r","            % Fetch data objects and associations for a process\r","            % processId: ID of the process to fetch data objects for\r","            % Returns a table with data object information\r","            \r","            if ~obj.Connected\r","                error('Database connection not established. Call connect first.');\r","            end\r","            \r","            tables = obj.listTables();\r","            \r","            % Check if we have the modern schema structure\r","            if ismember('data_objects', tables)\r","                query = ['SELECT do.*, ep.x, ep.y, ep.width, ep.height ', ...\r","                         'FROM data_objects do ', ...\r","                         'LEFT JOIN element_positions ep ON do.data_object_id = ep.element_id ', ...\r","                         'WHERE do.process_id = ''', processId, ''' ', ...\r","                         'ORDER BY do.data_object_id'];\r","                         \r","                data = exec(obj.Connection, query);\r","                data = fetch(data);\r","                \r","                % Cache the result\r","                cacheKey = ['data_objects_', processId];\r","                if height(data) < 1000\r","                    obj.QueryCache(cacheKey) = data;\r","                end\r","            else\r","                % Return empty table if schema doesn't support data objects\r","                data = table();\r","            end\r","        end\r","        \r","        function data = fetchDataAssociations(obj)\r","            % Fetch data associations with waypoints\r","            % Returns a table with data association information\r","            \r","            if ~obj.Connected\r","                error('Database connection not established. Call connect first.');\r","            end\r","            \r","            tables = obj.listTables();\r","            \r","            % Check if we have the modern schema structure\r","            if ismember('data_associations', tables) && ismember('waypoints', tables)\r","                query = ['SELECT da.*, GROUP_CONCAT(CONCAT(wp.sequence, \":\", wp.x, \":\", wp.y) ', ...\r","                         'ORDER BY wp.sequence SEPARATOR \";\") as waypoints_data ', ...\r","                         'FROM data_associations da ', ...\r","                         'LEFT JOIN waypoints wp ON da.association_id = wp.flow_id ', ...\r","                         'GROUP BY da.association_id ', ...\r","                         'ORDER BY da.association_id'];\r","                \r","                data = exec(obj.Connection, query);\r","                data = fetch(data);\r","                \r","                % Cache the result\r","                if height(data) < 1000\r","                    obj.QueryCache('data_associations') = data;\r","                end\r","            else\r","                % Return empty table if schema doesn't support data associations\r","                data = table();\r","            end\r","        end\r","        \r","        function data = fetchDiagramInfo(obj, processId)\r","            % Fetch diagram information (element positions and waypoints)\r","            % processId: ID of the process to fetch diagram info for\r","            % Returns a table with diagram positioning data\r","            \r","            if ~obj.Connected\r","                error('Database connection not established. Call connect first.');\r","            end\r","            \r","            tables = obj.listTables();\r","            \r","            % Check if we have the modern schema structure\r","            if ismember('element_positions', tables)\r","                query = ['SELECT ep.* ', ...\r","                         'FROM element_positions ep ', ...\r","                         'JOIN bpmn_elements e ON ep.element_id = e.element_id ', ...\r","                         'WHERE e.process_id = ''', processId, ''' ', ...\r","                         'ORDER BY ep.element_id'];\r","                \r","                data = exec(obj.Connection, query);\r","                data = fetch(data);\r","                \r","                % Cache the result\r","                cacheKey = ['diagram_info_', processId];\r","                if height(data) < 1000\r","                    obj.QueryCache(cacheKey) = data;\r","                end\r","            else\r","                % Return empty table if schema doesn't support element positions\r","                data = table();\r","            end\r","        end\r","        \r","        function data = fetchAnnotations(obj, processId)\r","            % Fetch text annotations for a process\r","            % processId: ID of the process to fetch annotations for\r","            % Returns a table with text annotation data\r","            \r","            if ~obj.Connected\r","                error('Database connection not established. Call connect first.');\r","            end\r","            \r","            % Try to find text annotations in the elements table\r","            query = ['SELECT e.*, ep.x, ep.y, ep.width, ep.height ', ...\r","                     'FROM bpmn_elements e ', ...\r","                     'LEFT JOIN element_positions ep ON e.element_id = ep.element_id ', ...\r","                     'WHERE e.element_type = ''textAnnotation'' ', ...\r","                     'AND e.process_id = ''', processId, ''' ', ...\r","                     'ORDER BY e.element_id'];\r","            \r","            data = exec(obj.Connection, query);\r","            data = fetch(data);\r","            \r","            % If no annotations found, return empty table\r","            if isempty(data)\r","                data = table();\r","            else\r","                % Cache the result\r","                cacheKey = ['annotations_', processId];\r","                if height(data) < 1000\r","                    obj.QueryCache(cacheKey) = data;\r","                end\r","            end\r","        end\r","        \r","        function data = fetchAssociations(obj, processId)\r","            % Fetch non-data associations for a process (like text annotation connections)\r","            % processId: ID of the process to fetch associations for\r","            % Returns a table with association data\r","            \r","            if ~obj.Connected\r","                error('Database connection not established. Call connect first.');\r","            end\r","            \r","            tables = obj.listTables();\r","            \r","            % Try to query associations\r","            if ismember('sequence_flows', tables)\r","                query = ['SELECT sf.*, GROUP_CONCAT(CONCAT(wp.sequence, \":\", wp.x, \":\", wp.y) ', ...\r","                         'ORDER BY wp.sequence SEPARATOR \";\") as waypoints_data ', ...\r","                         'FROM sequence_flows sf ', ...\r","                         'LEFT JOIN waypoints wp ON sf.flow_id = wp.flow_id ', ...\r","                         'WHERE sf.process_id = ''', processId, ''' ', ...\r","                         'AND sf.flow_type = ''association'' ', ... % Assuming flow_type column exists\r","                         'GROUP BY sf.flow_id ', ...\r","                         'ORDER BY sf.flow_id'];\r","                \r","                data = exec(obj.Connection, query);\r","                data = fetch(data);\r","                \r","                % Cache the result\r","                cacheKey = ['associations_', processId];\r","                if height(data) < 1000\r","                    obj.QueryCache(cacheKey) = data;\r","                end\r","            else\r","                % Return empty table if schema doesn't have flow_type column\r","                data = table();\r","            end\r","        end\r","        \r","    end % End of regular methods block - Ensure this is present and correctly placed\r","    \r","    methods(Static) % Start of static methods block\r","        function dataStore = getSetTempStore(data)\r","            % Helper function to manage a persistent temporary data store\r","            persistent TempDataStore;\r","            if isempty(TempDataStore)\r","                TempDataStore = struct(); % Initialize if first time\r","            end\r","\r","            if nargin == 1 % Set data\r","                TempDataStore = data;\r","            end\r","            dataStore = TempDataStore; % Return current store\r","        end % End of getSetTempStore\r","\r","        function insertedIDs = insertRows(tableName, rows)\r","            % insertRows - Static method to insert data rows into a temporary store\r","            % tableName: Name of the table (field name in the store)\r","            % rows: Struct array of data to insert\r","            % Returns: Array of dummy IDs for the inserted rows\r","\r","            fprintf('--- Inserting %d rows into temporary store for table: %s ---\\n', numel(rows), tableName);\r","\r","            if isempty(rows)\r","                 insertedIDs = {};\r","                 fprintf('--- No rows provided for table: %s. Skipping insertion. ---\\n', tableName);\r","                 return;\r","            end\r","\r","            % Ensure rows is a struct array\r","            if ~isstruct(rows)\r","                 warning('BPMNDatabaseConnector:insertRows:InvalidInput', ...\r","                         'Input \"rows\" for table %s is not a struct array. Skipping insertion.', tableName);\r","                 insertedIDs = {};\r","                 return;\r","            end\r","\r","            tempStore = BPMNDatabaseConnector.getSetTempStore(); % Get current store\r","\r","            % Generate dummy IDs\r","            numExisting = 0;\r","            if isfield(tempStore, tableName) && isstruct(tempStore.(tableName))\r","                numExisting = numel(tempStore.(tableName));\r","            end\r","            insertedIDs = arrayfun(@(x) sprintf('%s_ID_%d', upper(tableName), numExisting + x), 1:numel(rows), 'UniformOutput', false);\r","\r","            % Add dummy IDs to the rows if an 'id' field is expected (heuristic)\r","            idField = '';\r","            if endsWith(tableName, 's') % e.g., processes -> process_id\r","                idField = [tableName(1:end-1) '_id'];\r","            elseif strcmp(tableName, 'bpmn_elements')\r","                idField = 'element_id';\r","            % Add more specific cases if needed\r","\r","            if ~isempty(idField) && isfield(rows, idField)\r","                 for i = 1:numel(rows)\r","                     % Only assign if the field is empty or non-existent,\r","                     % assuming LLM might sometimes provide one.\r","                     if ~isfield(rows(i), idField) || isempty(rows(i).(idField))\r","                         rows(i).(idField) = insertedIDs{i};\r","                     else\r","                         % If LLM provided an ID, use that instead of overwriting\r","                         insertedIDs{i} = rows(i).(idField);\r","                     end\r","                 end\r","            elseif ~isempty(idField) && ~isfield(rows, idField)\r","                 % Add the ID field if it doesn't exist at all\r","                 for i = 1:numel(rows)\r","                     rows(i).(idField) = insertedIDs{i};\r","                 end\r","            end\r","\r","\r","            % Append rows to the store\r","            if isfield(tempStore, tableName) && ~isempty(tempStore.(tableName))\r","                % Ensure consistent fields before concatenating\r","                 existingFields = fieldnames(tempStore.(tableName));\r","                 newFields = fieldnames(rows);\r","                 allFields = union(existingFields, newFields);\r","\r","                 % Add missing fields to existing data\r","                 for k = 1:numel(existingFields)\r","                     fld = existingFields{k};\r","                     if ~isfield(rows, fld)\r","                         [rows.(fld)] = deal([]); % Add missing field with default empty\r","                     end\r","                 end\r","                 % Add missing fields to new data\r","                 for k = 1:numel(newFields)\r","                     fld = newFields{k};\r","                     if ~isfield(tempStore.(tableName), fld)\r","                          [tempStore.(tableName).(fld)] = deal([]); % Add missing field with default empty\r","                     end\r","                 end\r","\r","                 % Reorder fields to match before concatenating\r","                 rows = orderfields(rows, tempStore.(tableName)(1)); % Match order of existing data\r","\r","                tempStore.(tableName) = [tempStore.(tableName); rows(:)];\r","            else\r","                tempStore.(tableName) = rows(:);\r","            end\r","\r","            BPMNDatabaseConnector.getSetTempStore(tempStore); % Save updated store\r","\r","            fprintf('--- Temp insertRows finished for table: %s. Total rows: %d ---\\n', tableName, numel(tempStore.(tableName)));\r","        end % End of insertRows\r","\r","        function allData = fetchAll(tableNames)\r","             % fetchAll - Static method to fetch data from the temporary store\r","             % tableNames: Cell array of table names to fetch from\r","             % Returns: Struct where each field is a table name containing fetched data\r","\r","             fprintf('--- Fetching data from temporary store for tables: %s ---\\n', strjoin(tableNames, ', '));\r","             allData = struct();\r","             tempStore = BPMNDatabaseConnector.getSetTempStore(); % Get current store\r","\r","             if ~iscell(tableNames)\r","                 tableNames = {tableNames}; % Ensure it's a cell array\r","             end\r","\r","             for i = 1:numel(tableNames)\r","                 tableName = tableNames{i};\r","                 if isfield(tempStore, tableName)\r","                     allData.(tableName) = tempStore.(tableName);\r","                     fprintf('--- Fetched %d rows for table %s ---\\n', numel(allData.(tableName)), tableName);\r","                 else\r","                     allData.(tableName) = struct([]); % Return empty struct array if table not found\r","                     fprintf('--- Table %s not found in temporary store ---\\n', tableName);\r","                 end\r","             end\r","             fprintf('--- Temp fetchAll finished ---\\n');\r","        end % End of fetchAll\r","\r","    end % End of static methods block\r","\r","end % End of classdef BPMNDatabaseConnector"],"CoverageDisplayDataPerLine":{"Function":[],"Statement":[]},"FilterData":[]}